# ROS日志分析指南

本指南专门针对您提供的 rk3399-yocto ROS日志文件，演示如何使用本扩展进行高效分析。

## 📁 您的日志文件说明

### 文件清单
根据您的截图，您有以下日志文件：

| 文件名 | 大小 | 时间 | 类型 |
|--------|------|------|------|
| sros.rk3399-yocto.root.log.INFO.20251031-113748.54407 | 9.0 MB | 2025/10/31 14:33 | 主日志 |
| sros.rk3399-yocto.root.log.INFO.20251031-143358.125029 | 9.6 MB | 2025/10/31 17:02 | 主日志 |
| sros.rk3399-yocto.root.log.INFO.20251031-170220.511723 | 5.6 MB | 2025/10/31 19:56 | 主日志 |
| sros.rk3399-yocto.root.log.INFO.20251101-105459.1534 | 4.6 MB | 2025/11/1 13:36 | 主日志 |
| srtos.20251031-113755.714308 | 132 KB | 2025/10/31 14:33 | 子系统日志 |
| srtos.20251031-143347.346741 | 1 KB | 2025/10/31 14:33 | 子系统日志 |
| srtos.20251031-143406.043826 | 5 KB | 2025/10/31 16:30 | 子系统日志 |
| srtos.20251031-170227.585797 | 5 KB | 2025/10/31 19:56 | 子系统日志 |
| srtos.20251101-105506.444049 | 131 KB | 2025/11/1 13:25 | 子系统日志 |

### 日志特征
- **系统平台**：rk3399-yocto（瑞芯微ARM平台）
- **日志类型**：ROS（机器人操作系统）
- **覆盖时间**：2025年10月31日 - 11月1日
- **总数据量**：约 30 MB

---

## 🚀 快速开始

### 步骤1：加载日志文件

1. **打开扩展**
   - 点击Chrome工具栏的扩展图标
   - 会在新标签页打开主界面

2. **上传日志文件**（三种方式）

   **方式A：点击上传**
   - 在左侧面板找到"上传本地日志文件"区域
   - 点击上传区域
   - 选择所有 `.log` 或相关文件

   **方式B：拖拽上传**
   - 直接将所有日志文件拖到上传区域
   - 支持多文件批量上传

   **方式C：远程获取**（如果日志在服务器上）
   - 填写服务器地址（例如：10.10.21.60:12000）
   - 选择时间范围：2025-10-31 11:00 到 2025-11-01 14:00
   - 点击"获取远程日志"

3. **等待处理**
   - 扩展会自动提取时间范围
   - 状态显示为"就绪"后即可搜索

---

## 🔍 常见分析场景

### 场景1：查找错误和异常

**目标**：找出所有系统错误

**操作步骤**：
1. 在"搜索关键词"框输入：
   ```
   error
   ERROR
   exception
   failed
   fatal
   ```
   （每行一个关键词）

2. 选择逻辑：**或（OR）**
3. 时间范围：选择"全部"
4. 点击"搜索"

**预期结果**：
- 显示所有包含错误相关信息的日志条目
- 按时间排序显示
- 错误关键词会高亮显示

---

### 场景2：追踪特定设备状态

**目标**：查看电梯设备的所有状态变化

**操作步骤**：
1. 使用预设模板：点击左侧"电梯状态变化"
2. 或手动输入关键词：
   ```
   elevator
   ResourceDevice
   floor
   door
   ```

3. 选择逻辑：**与（AND）** - 同时包含所有关键词
4. 点击"搜索"

**高级用法**：
- 如果要查看特定电梯，使用变量：
  - 点击"自定义"模板
  - 添加关键词：`elevator_${id}`
  - 会弹出对话框要求输入 `id`，例如输入 `01`
  - 搜索会查找 `elevator_01`

---

### 场景3：分析时间段内的通讯问题

**目标**：查看10月31日下午的设备通讯情况

**操作步骤**：
1. 设置时间范围：
   - 开始：2025-10-31 14:00
   - 结束：2025-10-31 18:00

2. 输入关键词：
   ```
   connect
   disconnect
   timeout
   communication
   网络
   通讯
   ```

3. 选择逻辑：**或（OR）**
4. 点击"搜索"

**结果分析**：
- 查看连接/断线的频率
- 标记异常条目到工作区
- 添加标签如"通讯异常"进行分类

---

### 场景4：订单执行流程追踪

**目标**：追踪特定订单的完整执行过程

**操作步骤**：
1. 点击预设模板："订单执行流程"
2. 系统会提示输入订单ID
3. 输入订单号，例如：`ORD20251031001`
4. 点击应用

**扩展会自动搜索**：
- 订单分配记录
- 任务开始
- 路径规划
- 执行进度
- 完成/失败状态

**工作区使用**：
- 将关键步骤标记到工作区
- 添加标签：`订单-ORD20251031001`
- 导出完整执行链路

---

## 📊 高级功能

### 功能1：工作区管理

**用途**：保存重要日志条目，添加备注和分类

**步骤**：
1. 在搜索结果中，点击任意条目旁的"标记"按钮
2. 日志会出现在右侧工作区
3. 在工作区中可以：
   - 添加标签（如：重要、待处理、已解决）
   - 标签会自动分配颜色
   - 点击标签旁的 ❌ 可删除标签
   - 点击"移除"可从工作区删除

4. 导出工作区：
   - 点击右上角"导出工作区"
   - 生成 `.txt` 文件
   - 格式：`[标签] 时间戳 - 日志内容`

**实际案例**：
```
分析一个系统故障：
1. 搜索故障时间段的所有ERROR
2. 将相关错误标记到工作区
3. 添加标签：
   - "根因" - 最初的错误
   - "影响" - 后续的连锁错误
   - "已修复" - 确认解决的问题
4. 导出作为故障报告
```

---

### 功能2：自定义模板

**用途**：保存常用搜索配置，避免重复输入

**创建模板**：
1. 点击右上角"模板管理"
2. 输入模板名称：`ROS通讯超时`
3. 在下方输入关键词：
   ```
   timeout
   connection lost
   retry
   ```
4. 选择逻辑（AND/OR）
5. 点击"保存模板"

**使用模板**：
- 下次点击"自定义"
- 从列表选择"ROS通讯超时"
- 自动填充关键词和逻辑

---

### 功能3：时间范围快捷选择

**用途**：快速切换常用时间段

**按钮说明**：
- **全部**：显示所有上传文件的时间范围
- **最近1小时**：从最新日志往前1小时
- **最近6小时**：从最新日志往前6小时
- **最近24小时**：从最新日志往前24小时

**场景**：
当您上传了2天的日志，但只想看最近1小时的错误：
1. 输入错误关键词
2. 点击"最近1小时"
3. 点击搜索

---

## 💡 实战工作流

### 工作流1：日常运维检查

```
目标：每日检查系统健康状况

1. 上传当天的所有日志文件
   └─ 拖拽所有 sros.*.log 文件到上传区

2. 检查错误
   └─ 模板："通讯日志" 或搜索 error, failed
   └─ 查看是否有异常错误

3. 检查关键设备
   └─ 模板："电梯状态变化"
   └─ 模板："路径规划结果"
   └─ 确认设备正常运行

4. 标记重要事件
   └─ 将异常标记到工作区
   └─ 添加标签："待跟进"

5. 导出报告
   └─ 导出工作区为日报
```

---

### 工作流2：故障排查

```
目标：分析10月31日下午的系统故障

1. 加载相关时间段日志
   └─ 上传 sros.*20251031-143358.* 等文件

2. 缩小时间范围
   └─ 设置搜索时间：14:30 - 15:30（故障发生时间）

3. 搜索故障特征
   └─ 关键词：error, exception, timeout, failed
   └─ 逻辑：OR（任意匹配）

4. 按时间顺序分析
   └─ 结果已按时间排序
   └─ 找到最早的错误（根因）

5. 扩展搜索关联模块
   └─ 根据根因涉及的模块（如：通讯、订单）
   └─ 添加模块相关关键词
   └─ 重新搜索

6. 构建故障链路
   └─ 将关键日志标记到工作区
   └─ 按故障阶段添加标签：
      - "根因"
      - "传播"
      - "恢复"

7. 生成故障报告
   └─ 导出工作区
   └─ 包含完整时间线和标注
```

---

### 工作流3：性能分析

```
目标：分析路径规划性能

1. 加载日志
   └─ 上传所有 sros.*.log

2. 使用路径规划模板
   └─ 点击"路径规划结果"
   └─ 会搜索所有规划相关日志

3. 查找耗时信息
   └─ 添加关键词：
      - time cost
      - duration
      - ms（毫秒）
      - 耗时

4. 标记慢查询
   └─ 查看包含"耗时"的条目
   └─ 标记耗时 > 100ms 的记录
   └─ 添加标签："性能优化"

5. 导出数据
   └─ 导出工作区
   └─ 用于进一步分析或报告
```

---

## 🎯 针对您日志的具体建议

### 建议1：对比不同时间段

您有4个不同时间段的主日志：
- 10/31 11:37
- 10/31 14:33
- 10/31 17:02
- 11/01 10:54

**操作**：
1. 第一次搜索：只上传 10/31 11:37 的日志
2. 记录搜索结果数量
3. 清空，上传 10/31 14:33 的日志
4. 使用相同关键词搜索
5. 对比两次结果，找出差异

**用途**：发现不同时间段的异常模式

---

### 建议2：关联主日志和子系统日志

注意到每个主日志（sros.*）都有对应的子系统日志（srtos.*）：
- sros.*113748.54407 (9MB) ↔ srtos.*113755.714308 (132KB)
- sros.*143358.125029 (9.6MB) ↔ srtos.*143347.346741 (1KB)

**操作**：
1. 同时上传对应的两个文件
2. 在主日志中发现错误后
3. 搜索相同时间戳
4. 查看子系统日志是否有相关信息

---

### 建议3：创建ROS专用模板

根据ROS系统特点，建议创建以下模板：

**模板1：节点通讯**
```
名称：ROS节点通讯
关键词：
  - node
  - publish
  - subscribe
  - topic
  - message
逻辑：OR
```

**模板2：服务调用**
```
名称：ROS服务调用
关键词：
  - service
  - call
  - request
  - response
逻辑：AND
```

**模板3：参数服务器**
```
名称：ROS参数变化
关键词：
  - param
  - parameter
  - set
  - get
逻辑：OR
```

---

## ⚙️ 设置建议

### 如果您有远程日志服务器

1. 点击右上角"设置"
2. 输入API Token（如果服务器需要认证）
3. 保存设置

之后可以直接：
- 输入服务器地址：`10.10.21.60:12000`（示例）
- 选择时间范围
- 点击"获取远程日志"
- 自动下载并解压TAR包

---

## 📝 注意事项

### 性能相关
1. **大文件处理**：您的日志最大9.6MB，处理需要几秒钟
2. **搜索限制**：单次搜索最多返回20,000条结果
3. **内存占用**：同时上传所有30MB日志会占用较多内存
4. **建议**：按时间段分批上传和分析

### 搜索技巧
1. **关键词大小写**：搜索不区分大小写（error 和 ERROR 相同）
2. **AND逻辑**：要求所有关键词都出现，结果更精确
3. **OR逻辑**：任意关键词出现即可，结果更全面
4. **时间过滤**：先宽泛搜索，再用时间范围缩小

### 数据持久化
1. **工作区自动保存**：标记的日志会保存在浏览器中
2. **关闭标签不丢失**：重新打开扩展，工作区仍在
3. **清理浏览器数据会丢失**：建议定期导出工作区

---

## 🎓 示例：完整分析一个日志

假设您要分析 `sros.rk3399-yocto.root.log.INFO.20251031-113748.54407`：

```bash
# 文件信息
名称：sros.rk3399-yocto.root.log.INFO.20251031-113748.54407
大小：9.0 MB
时间：2025/10/31 11:37:48 开始
进程：54407
```

### 分析步骤：

**1. 上传文件**
- 拖拽到上传区
- 等待"就绪"状态

**2. 查看整体情况**
- 查看提取的时间范围（例如：11:37 - 12:45）
- 点击"全部"查看覆盖时间

**3. 健康检查**
```
关键词：error, failed, exception
逻辑：OR
时间：全部
```
→ 查看错误数量和分布

**4. 重点分析**
如果发现11:50有大量错误：
```
时间范围：11:45 - 11:55
关键词：保持不变
```
→ 缩小到10分钟窗口

**5. 深挖根因**
查看11:50第一条错误，假设是：
```
2025-10-31 11:50:23.456 [ERROR] Connection to device elevator_01 lost
```

新搜索：
```
关键词：elevator_01, connection
逻辑：AND
时间：11:40 - 11:50
```
→ 查看连接断开前的状态

**6. 构建时间线**
将相关日志标记到工作区：
- 11:48 - 正常连接 → 标签：正常
- 11:49 - 连接警告 → 标签：预警
- 11:50 - 连接丢失 → 标签：故障
- 11:52 - 重连失败 → 标签：影响
- 11:55 - 恢复连接 → 标签：恢复

**7. 导出报告**
导出工作区，得到：
```
[正常] 2025-10-31 11:48:15 - elevator_01 connection established
[预警] 2025-10-31 11:49:30 - elevator_01 connection unstable, retry count: 3
[故障] 2025-10-31 11:50:23 - Connection to device elevator_01 lost
[影响] 2025-10-31 11:52:10 - Reconnection failed, timeout after 120s
[恢复] 2025-10-31 11:55:40 - elevator_01 connection restored
```

---

## 🆘 常见问题

### Q1：上传后没有反应？
- 检查文件格式（.log, .txt, .gz, .tar）
- 查看浏览器控制台是否有错误（F12）
- 尝试上传单个小文件测试

### Q2：搜索没有结果？
- 检查时间范围是否覆盖日志时间
- 尝试更宽泛的关键词
- 使用OR逻辑增加匹配范围

### Q3：结果太多，显示缓慢？
- 使用更具体的关键词
- 缩小时间范围
- 使用AND逻辑提高精确度

### Q4：工作区标记丢失？
- 检查是否清理了浏览器数据
- 建议定期导出工作区备份

---

## 📚 相关资源

- **Chrome扩展文档**：了解扩展权限和存储限制
- **ROS日志格式**：了解日志结构以更好地搜索
- **正则表达式**：未来版本可能支持正则搜索

---

## 🔄 下一步

现在您可以：

1. ✅ 打开Chrome扩展
2. ✅ 上传您的ROS日志文件
3. ✅ 尝试预设模板或自定义搜索
4. ✅ 将重要发现标记到工作区
5. ✅ 导出分析结果

**祝您分析顺利！** 🎉

如有问题，请查看 `README.md` 或 `CLAUDE.md` 获取技术细节。
