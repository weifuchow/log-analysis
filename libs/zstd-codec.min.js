// Placeholder shim for zstd-codec@0.1.5 when offline.
// When network is available, replace this file with the real build from:
// https://cdn.jsdelivr.net/npm/zstd-codec@0.1.5/dist/zstd-codec.min.js
// (See libs/zstd-codec-download.md for full instructions.)
(function(global){
    const root = typeof global !== 'undefined' ? global : (typeof window !== 'undefined' ? window : globalThis);

    function hasNativeZstdStream(){
        if (typeof DecompressionStream === 'undefined') return false;
        try {
            // Some browsers may throw when the format is not supported
            new DecompressionStream('zstd');
            return true;
        } catch (err) {
            return false;
        }
    }

    async function nativeDecompress(data){
        const stream = new DecompressionStream('zstd');
        const writer = stream.writable.getWriter();
        await writer.write(data);
        await writer.close();
        const response = new Response(stream.readable);
        const buffer = await response.arrayBuffer();
        return new Uint8Array(buffer);
    }

    class Simple{
        decompress(data){
            const input = data instanceof Uint8Array ? data : new Uint8Array(data);
            if (!hasNativeZstdStream()) {
                throw new Error('Native zstd decompression is unavailable. Please replace libs/zstd-codec.min.js with the real zstd-codec@0.1.5 build when network access is available.');
            }
            return nativeDecompress(input);
        }
    }

    const codec = { Simple };
    root.ZstdCodec = {
        Simple,
        run(callback){
            try{
                callback(codec);
            }catch(err){
                throw err;
            }
        }
    };
})(typeof self !== 'undefined' ? self : this);
